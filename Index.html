<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Santy - Autopedido</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primario: #d32f2f; --secundario: #333; --fondo: #f5f5f5; --blanco: #ffffff; --exito: #2e7d32; }
        body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: var(--fondo); text-align: center; color: #333; }
        .pantalla { padding: 20px; max-width: 500px; margin: auto; min-height: 100vh; }
        .oculto { display: none !important; }
        .cat-titulo { text-align: left; background: #e0e0e0; padding: 8px 12px; border-radius: 8px; font-size: 1.1rem; margin-top: 25px; border-left: 5px solid var(--primario); }
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .btn-producto { background: var(--blanco); border: 1px solid #ddd; border-radius: 12px; padding: 15px 8px; font-size: 0.9rem; font-weight: bold; display: flex; flex-direction: column; cursor: pointer; }
        .precio-tag { color: var(--exito); margin-top: 5px; font-size: 1rem; }
        .btn-main { width: 100%; padding: 16px; font-size: 1.1rem; border: none; border-radius: 12px; background: var(--primario); color: white; font-weight: bold; margin-top: 15px; cursor: pointer; }
        .btn-sec { background: var(--secundario); }
        .modal-pago { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .modal-contenido { background: white; padding: 30px 20px; border-radius: 20px; width: 85%; max-width: 350px; }
        .barra-total { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px 20px; box-shadow: 0 -3px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .resumen-turno { background: var(--secundario); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: left; font-size: 0.9rem; }
        label { display: block; padding: 15px; margin: 10px 0; border-radius: 10px; background: #f9f9f9; border: 2px solid #eee; cursor: pointer; font-weight: bold; }
        input[type="radio"] { transform: scale(1.5); margin-right: 15px; }
    </style>
</head>

<body>

<div id="modalPago" class="modal-pago oculto">
    <div class="modal-contenido">
        <h2 style="margin-top:0;">Transferencia</h2>
        <p style="margin-bottom:5px; color:#666;">Monto a transferir:</p>
        <strong id="montoTransferir" style="font-size: 3.5rem; color: var(--exito); display: block; margin-bottom: 20px;">$0</strong>
        <div style="background: #f0f0f0; padding: 20px; border-radius: 15px; border: 2px dashed #999;">
            <p style="margin:0; font-size: 1rem; color:#555;">Alias Mercado Pago:</p>
            <strong style="font-size: 1.8rem; color: #009ee3; letter-spacing: 1px;">BARSANTI.</strong>
        </div>
        <button class="btn-main" onclick="confirmarPedido('Transferencia')" style="background:#009ee3; margin-top:20px;">YA TRANSFER√ç</button>
        <button onclick="document.getElementById('modalPago').classList.add('oculto')" style="background:none; border:none; color:#666; margin-top:15px; cursor:pointer; font-weight:bold;">VOLVER</button>
    </div>
</div>

<div id="bienvenida" class="pantalla">
    <br><br>
    <h1 style="color:var(--primario)">üçî SANDWICHER√çA SANTY</h1>
    <p>¬°Hola! Haz tu pedido aqu√≠</p>
    <br>
    <button class="btn-main" onclick="mostrar('menu')">PEDIR AHORA</button>
    <button class="btn-main btn-sec" onclick="pedirClave()">MODO COCINA</button>
</div>

<div id="menu" class="pantalla oculto" style="padding-bottom: 100px;">
    <h3 class="cat-titulo">‚ú® Men√∫s y Promos</h3>
    <div class="grid-menu">
        <button class="btn-producto" onclick="agregar('Menu Diario', 5000, false)">Menu Diario <span class="precio-tag">$5.000</span></button>
        <button class="btn-producto" onclick="agregar('Menu Napolitana', 7000, false)">Menu Napo <span class="precio-tag">$7.000</span></button>
        <button class="btn-producto" onclick="agregar('Empanada Docena', 11000, false)">Empanada Doc. <span class="precio-tag">$11.000</span></button>
        <button class="btn-producto" onclick="agregar('Empanada 1/2 doc', 6000, false)">Empanada 1/2 <span class="precio-tag">$6.000</span></button>
    </div>
    <h3 class="cat-titulo">ü•© Nalga y Lomito</h3>
    <div class="grid-menu">
        <button class="btn-producto" onclick="agregar('Nalga Chico', 5000, true)">Nalga Chico <span class="precio-tag">$5.000</span></button>
        <button class="btn-producto" onclick="agregar('Nalga Com√∫n', 8000, true)">Nalga Com√∫n <span class="precio-tag">$8.000</span></button>
        <button class="btn-producto" onclick="agregar('Nalga Especial', 9000, true)">Nalga Especial <span class="precio-tag">$9.000</span></button>
        <button class="btn-producto" onclick="agregar('Lomito Com√∫n', 9000, true)">Lomito Com√∫n <span class="precio-tag">$9.000</span></button>
        <button class="btn-producto" onclick="agregar('Lomito Especial', 10000, true)">Lomito Esp. <span class="precio-tag">$10.000</span></button>
        <button class="btn-producto" onclick="agregar('S√∫per Santy', 15000, true)">SUPER SANTY <span class="precio-tag">$15.000</span></button>
    </div>
    <h3 class="cat-titulo">Gaseosas</h3>
    <div class="grid-menu">
        <button class="btn-producto" onclick="agregar('Coca cola 1Lt', 4000, true)">Coca cola 1Lt <span class="precio-tag">$4.000</span></button>
        <button class="btn-producto" onclick="agregar('Coca Cola 1,5 Lt', 5000, true)">Coca Cola 1,5Lt <span class="precio-tag">$4.500</span></button>
        <button class="btn-producto" onclick="agregar('Coca Cola 2Lt', 5000, true)">Coca Cola 2Lt <span class="precio-tag">$5.000</span></button>
        <button class="btn-producto" onclick="agregar('Pepsi 1,5Lt', 3500, true)">Pepsi <span class="precio-tag">$3.500</span></button>
        <button class="btn-producto" onclick="agregar('Mirinda 1,5', 3500, true)">Mirinda <span class="precio-tag">$3.500</span></button>
        <button class="btn-producto" onclick="agregar('Mirinda 3Lt', 5500, true)">Mirinda <span class="precio-tag">$5.500</span></button>
        <button class="btn-producto" onclick="agregar('fresh 1,5', 3000, true)">fresh <span class="precio-tag">$3.000</span></button>
        <button class="btn-producto" onclick="agregar('prity2Lt', 3500, true)">Prity <span class="precio-tag">$3.500</span></button>
        <button class="btn-producto" onclick="agregar('Lata pepsi', 2000, true)">lata pepsi <span class="precio-tag">$2.000</span></button>
   </div> 
    <h3 class="c<button class="btn-producto" onclick="agregar('Nalga Chico', 5000, true)">Nalga Chico <span class="precio-tag">$5.000</span></button>at-titulo">üçî Molida</h3>
    <div class="grid-menu">
        <button class="btn-producto" onclick="agregar('Molida Chica', 3000, true)">Molida Chica <span class="precio-tag">$3.000</span></button>
        <button class="btn-producto" onclick="agregar('Molida Com√∫n', 4000, true)">Molida Com√∫n <span class="precio-tag">$4.000</span></button>
        <button class="btn-producto" onclick="agregar('Molida Super', 9500, true)">Molida Super <span class="precio-tag">$9.500</span></button>
    </div>
    <h3 class="cat-titulo">üçï Pizzas,Napo y Mexicano</h3>
    <div class="grid-menu">
        <button class="btn-producto" onclick="agregar('Pizza Com√∫n', 9000, false)">Pizza Com√∫n <span class="precio-tag">$9.000</span></button>
        <button class="btn-producto" onclick="agregar('Pizza Especial', 10000, false)">Pizza Especial <span class="precio-tag">$10.000</span></button>
        <button class="btn-producto" onclick="agregar('Pizza Santy', 12000, false)">Pizza Santy <span class="precio-tag">$12.000</span></button> 
        <button class="btn-producto" onclick="agregar('mexicano p1', 14000, false)">mexicano p1 <span class="precio-tag">$14.000</span></button> 
        <button class="btn-producto" onclick="agregar('mexicano p2', 22000, false)">mexicano p2 <span class="precio-tag">$22.000</span></button> 
        <button class="btn-producto" onclick="agregar('napo p1', 14000, false)">napo p1 <span class="precio-tag">$14.000</span></button> 
        <button class="btn-producto" onclick="agregar('napo p2', 22000, false)">napo p2 <span class="precio-tag">$22.000</span></button> 
    </div>
    <div class="barra-total">
        <div><strong>Total: $<span id="total">0</span></strong></div>
        <button onclick="mostrar('carrito')" style="background:var(--exito); color:white; border:none; padding:12px 20px; border-radius:10px; font-weight:bold;">VER PEDIDO</button>
    </div>
</div>
<div id="configurador" class="pantalla oculto">
    <h3>¬øC√≥mo quieres tu s√°ndwich?</h3>
    <div class="opcion-card">
        <label><input type="radio" name="prep" value="COMPLETO" checked> üî• COMPLETO</label>
        <label><input type="radio" name="prep" value="SIN AJI"> ü•¨ SIN AJI</label>
        <label><input type="radio" name="prep" value="VERDURA Y MAYO"> ü•¨ VERDURA Y MAYO</label>
        <label><input type="radio" name="prep" value="SOLO VERDURA"> ü•¨ SOLO VERDURA</label>
        <label><input type="radio" name="prep" value="SOLO CARNE"> ü•© SOLO CARNE</label>
    </div>
    <button class="btn-main" onclick="finalizarConfiguracion()">AGREGAR</button>
</div>

<div id="carrito" class="pantalla oculto">
    <h2>Tu Pedido</h2>
    <div style="background:white; border-radius:12px; padding:15px; text-align:left; border: 1px solid #ddd;">
        <ul id="lista" style="list-style:none; padding:0; margin:0;"></ul>
        <hr>
        <h3 style="margin:10px 0;">Total: $<span id="total2">0</span></h3>
    </div>
    <button class="btn-main" onclick="mostrar('pago')">CONFIRMAR</button>
    <button class="btn-main btn-sec" onclick="mostrar('menu')">AGREGAR M√ÅS</button>
</div>

<div id="pago" class="pantalla oculto">
    <h2>Forma de Pago</h2>
    <button class="btn-main" onclick="confirmarPedido('Efectivo')">üíµ EFECTIVO EN CAJA</button>
    <button class="btn-main" style="background:#009ee3;" onclick="abrirTransferencia()">üì± TRANSFERENCIA / ALIAS</button>
</div>

<div id="ticket" class="pantalla oculto">
    <div style="background:white; padding:40px 20px; border-radius:20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <h2>¬°PEDIDO RECIBIDO!</h2>
        <h1 style="font-size: 5rem; color:var(--primario);">#<span id="orden"></span></h1>
    </div>
    <button class="btn-main" onclick="reiniciar()">HACER OTRO PEDIDO</button>
</div>

<div id="cocina" class="pantalla oculto">
    <div class="resumen-turno">
        <h3 style="margin:0">üí∞ Caja del Turno</h3>
        <p>Efectivo: <b>$<span id="cajaEfec">0</span></b></p>
        <p>Transf: <b>$<span id="cajaTrans">0</span></b></p>
        <hr>
        <p>Total: <b>$<span id="cajaTotal">0</span></b> | Pedidos: <b><span id="pedidosTurno">0</span></b></p>
        <button onclick="cerrarTurno()" style="background:red; color:white; border:none; padding:8px; border-radius:5px; width:100%; font-weight:bold;">CERRAR TURNO</button>
    </div>
    <div id="pedidosCocina"></div>
    <button class="btn-main btn-sec" onclick="mostrar('bienvenida')">SALIR</button>
</div>

<script>
let pedido = []; let totalAcumulado = 0; let productoTemporal = null;
let ordenActual = Number(localStorage.getItem("orden")) || 1;
let pedidosHistorial = JSON.parse(localStorage.getItem("pedidosHistorial")) || [];
let cajaEfectivo = Number(localStorage.getItem("cajaEfectivo")) || 0;
let cajaTransferencia = Number(localStorage.getItem("cajaTransferencia")) || 0;
let contadorPedidos = Number(localStorage.getItem("contadorPedidos")) || 0;

function mostrar(id){
    document.querySelectorAll(".pantalla").forEach(p => p.classList.add("oculto"));
    document.getElementById(id).classList.remove("oculto");
    if(id === "carrito") cargarCarrito();
}

function cargarCarrito(){
    const lista = document.getElementById("lista"); lista.innerHTML = "";
    pedido.forEach(p => {
        lista.innerHTML += `<li style="margin-bottom:8px; border-bottom:1px solid #eee; padding-bottom:5px; text-align:left;">
            <b>${p.nombre}</b> <small style="color:red">(${p.opciones})</small> <span style="float:right">$${p.precio}</span>
        </li>`;
    });
    document.getElementById("total2").innerText = totalAcumulado;
}

function agregar(nombre, precio, esPerso){
    if(esPerso){ productoTemporal = { nombre, precio }; mostrar('configurador'); }
    else { confirmarSuma(nombre, precio, "Estandar"); }
}

function finalizarConfiguracion(){
    const prep = document.querySelector('input[name="prep"]:checked').value;
    confirmarSuma(productoTemporal.nombre, productoTemporal.precio, prep);
    mostrar('menu');
}

function confirmarSuma(nombre, precio, opciones){
    pedido.push({nombre, precio, opciones});
    totalAcumulado += precio;
    document.getElementById("total").innerText = totalAcumulado;
}

function abrirTransferencia(){
    document.getElementById("montoTransferir").innerText = "$" + totalAcumulado;
    document.getElementById("modalPago").classList.remove("oculto");
}

function confirmarPedido(metodo){
    if (pedido.length === 0) return;
    const num = ordenActual++; 
    localStorage.setItem("orden", ordenActual);
    
    // GUARDADO CLAVE: Capturamos el totalAcumulado exacto en este objeto
    const nuevaOrden = {
        orden: num,
        items: [...pedido],
        montoFijo: totalAcumulado, 
        metodo: metodo,
        estado: "Pendiente"
    };
    
    pedidosHistorial.push(nuevaOrden);
    localStorage.setItem("pedidosHistorial", JSON.stringify(pedidosHistorial));
    
    document.getElementById("orden").innerText = num;
    document.getElementById("modalPago").classList.add("oculto");
    mostrar('ticket');
}

function pedirClave(){ if(prompt("Clave:") === "1234") mostrarCocina(); }

function mostrarCocina(){
    mostrar("cocina");
    actualizarCajaUI();
    const cont = document.getElementById("pedidosCocina"); cont.innerHTML = "";
    pedidosHistorial.forEach(p => {
        if(p.estado !== "LISTO"){
            cont.innerHTML += `
                <div style="background:white; margin:10px 0; padding:15px; border-radius:10px; border-left:8px solid var(--primario); text-align:left;">
                    <strong>ORDEN #${p.orden}</strong> - Pago: ${p.metodo}
                    <ul style="padding-left:15px; margin:5px 0;">
                        ${p.items.map(i => `<li>${i.nombre} <small>(${i.opciones})</small></li>`).join("")}
                    </ul>
                    <p>Monto: <b>$${p.montoFijo}</b></p>
                    <button class="btn-main" style="padding:10px; background:var(--exito)" onclick="marcarListo(${p.orden})">MARCAR LISTO / COBRADO</button>
                </div>`;
        }
    });
}

function marcarListo(n){
    pedidosHistorial = pedidosHistorial.map(p => {
        if(p.orden === n) {
            p.estado = "LISTO";
            if(p.metodo === 'Efectivo') cajaEfectivo += p.montoFijo;
            else cajaTransferencia += p.montoFijo;
            contadorPedidos++;
        }
        return p;
    });
    localStorage.setItem("cajaEfectivo", cajaEfectivo);
    localStorage.setItem("cajaTransferencia", cajaTransferencia);
    localStorage.setItem("contadorPedidos", contadorPedidos);
    localStorage.setItem("pedidosHistorial", JSON.stringify(pedidosHistorial));
    mostrarCocina();
}

function actualizarCajaUI(){
    document.getElementById("cajaEfec").innerText = cajaEfectivo;
    document.getElementById("cajaTrans").innerText = cajaTransferencia;
    document.getElementById("cajaTotal").innerText = cajaEfectivo + cajaTransferencia;
    document.getElementById("pedidosTurno").innerText = contadorPedidos;
}

function cerrarTurno(){
    if(confirm("¬øCerrar turno? Se reiniciar√° todo.")){
        localStorage.clear();
        location.reload();
    }
}

function reiniciar(){
    pedido = []; totalAcumulado = 0;
    document.getElementById("total").innerText = 0;
    mostrar('bienvenida');
}
</script>
</body>
</html>
